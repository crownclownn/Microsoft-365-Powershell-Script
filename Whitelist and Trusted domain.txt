# Connect to Exchange Online
$UserCredential = Get-Credential
Connect-ExchangeOnline -UserPrincipalName $UserCredential.UserName -ShowProgress $true

# Get trusted/whitelisted domains
$TrustedDomains = Get-HostedContentFilterPolicy | Select-Object -ExpandProperty AllowedSenderDomains
$TrustedDomainList = @()

foreach ($Domain in $TrustedDomains) {
    $TrustedDomainList += [PSCustomObject]@{
        DomainName = $Domain
    }
}

# Export the data to a CSV file
$TrustedDomainList | Export-Csv -Path "C:\TrustedDomains.csv" -NoTypeInformation

# Disconnect from Exchange Online
Disconnect-ExchangeOnline -Confirm:$false